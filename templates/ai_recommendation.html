{% extends "base.html" %}

{% block title %}AI Recommendations - AI Car Rentals{% endblock %}

{% block content %}
<section class="page-header" style="background: url('../static/images/backgrounds/recommendation-bg.jpg') no-repeat center center/cover; height: 300px;">
    <div class="container">
        <div class="header-content" style="position: relative; z-index: 10; padding-top: 100px; text-align: center; color: white;">
            <h1>AI Car Recommendations</h1>
            <p>Our intelligent system finds your perfect vehicle match</p>
        </div>
    </div>
</section>

<section class="recommendation-section">
    <div class="container">
        <div class="ai-intro" style="max-width: 800px; margin: 0 auto 50px; text-align: center;">
            <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 20px;">
                <i class="fas fa-brain"></i>
            </div>
            <h2>How Our AI Works</h2>
            <p>Our recommendation engine analyzes your preferences, travel needs, and driving habits to suggest vehicles that perfectly match your requirements. By continuously learning from user choices and feedback, our system becomes more personalized over time.</p>
        </div>
        
        <div class="recommendation-form">
            <h3><i class="fas fa-sliders-h"></i> Tell Us Your Preferences</h3>
            <form id="recommendation-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="trip-purpose">Trip Purpose</label>
                        <select id="trip-purpose" name="purpose">
                            <option value="business">Business Trip</option>
                            <option value="family">Family Vacation</option>
                            <option value="weekend">Weekend Getaway</option>
                            <option value="road-trip">Road Trip</option>
                            <option value="moving">Moving / Hauling</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">Vehicle Category</label>
                        <select id="category" name="category">
                            <option value="Compact">Compact</option>
                            <option value="Sedan">Sedan</option>
                            <option value="SUV">SUV</option>
                            <option value="Luxury">Luxury</option>
                            <option value="Electric">Electric</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="seats">Number of Passengers</label>
                        <select id="seats" name="seats">
                            <option value="1">1-2 People</option>
                            <option value="3">3-4 People</option>
                            <option value="5">5+ People</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="max-price">Maximum Budget ($ per day)</label>
                        <input type="range" id="max-price" name="max_price" min="50" max="300" step="10" value="150">
                        <div style="display: flex; justify-content: space-between;">
                            <span>$50</span>
                            <span id="price-display">$150</span>
                            <span>$300</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="features">Important Features</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <input type="checkbox" id="feature-gps" name="features[]" value="gps">
                                <label for="feature-gps">GPS Navigation</label>
                            </div>
                            <div>
                                <input type="checkbox" id="feature-bluetooth" name="features[]" value="bluetooth">
                                <label for="feature-bluetooth">Bluetooth</label>
                            </div>
                            <div>
                                <input type="checkbox" id="feature-camera" name="features[]" value="camera">
                                <label for="feature-camera">Backup Camera</label>
                            </div>
                            <div>
                                <input type="checkbox" id="feature-sunroof" name="features[]" value="sunroof">
                                <label for="feature-sunroof">Sunroof</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="driving-style">Driving Style</label>
                        <select id="driving-style" name="driving_style">
                            <option value="eco">Eco-friendly</option>
                            <option value="comfort">Comfort-oriented</option>
                            <option value="luxury">Luxury Experience</option>
                            <option value="sport">Sport/Performance</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="additional-info">Additional Information</label>
                    <textarea id="additional-info" name="additional_info" placeholder="Tell us more about your needs, preferences, or any special requirements..."></textarea>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn"><i class="fas fa-magic"></i> Get AI Recommendations</button>
                </div>
            </form>
        </div>
        
        <div id="recommendation-results" class="recommendations-results">
            <!-- Results will be populated here via JavaScript -->
        </div>
    </div>
</section>

<section class="ai-features" style="padding: 80px 0; background: #f0f8ff;">
    <div class="container">
        <h2 class="section-title">How Our AI Makes Better Recommendations</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 50px;">
            <div class="feature-box" style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                <div style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 20px;">
                    <i class="fas fa-database"></i>
                </div>
                <h3>Learning From Data</h3>
                <p>Our AI analyzes thousands of rental patterns to understand which vehicles work best for different trip types, seasons, and customer profiles.</p>
            </div>
            
            <div class="feature-box" style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                <div style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 20px;">
                    <i class="fas fa-user-check"></i>
                </div>
                <h3>Personalized Experience</h3>
                <p>The more you interact with our system, the better it understands your preferences, creating increasingly tailored recommendations for your future rentals.</p>
            </div>
            
            <div class="feature-box" style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow);">
                <div style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 20px;">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>Trend Analysis</h3>
                <p>Our system identifies emerging patterns in vehicle preferences and anticipates needs based on seasonal trends, local events, and market conditions.</p>
            </div>
        </div>
    </div>
</section>

<section class="customer-stories" style="padding: 80px 0;">
    <div class="container">
        <h2 class="section-title">Success Stories</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 50px;">
            <div class="testimonial" style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); position: relative;">
                <div style="position: absolute; top: -15px; left: 30px; font-size: 2rem; color: var(--primary-color);">
                    <i class="fas fa-quote-left"></i>
                </div>
                <p style="margin-top: 20px;">The AI recommended a Tesla Model 3 for my business trip - I would have never considered an electric car, but it was perfect for my needs and saved me money on fuel!</p>
                <div style="margin-top: 20px; display: flex; align-items: center;">
                    <div style="width: 50px; height: 50px; border-radius: 50%; background: #ddd; margin-right: 15px; overflow: hidden;">
                        <img src="../static/images/testimonials/user1.jpg" alt="User" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div>
                        <h4 style="margin: 0; font-size: 1.1rem;">Michael Johnson</h4>
                        <p style="margin: 0; font-size: 0.9rem; color: #666;">Business Traveler</p>
                    </div>
                </div>
            </div>
            
            <div class="testimonial" style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); position: relative;">
                <div style="position: absolute; top: -15px; left: 30px; font-size: 2rem; color: var(--primary-color);">
                    <i class="fas fa-quote-left"></i>
                </div>
                <p style="margin-top: 20px;">For our family vacation, the AI suggested an SUV with specific features for children. It even considered our destination's terrain and weather conditions!</p>
                <div style="margin-top: 20px; display: flex; align-items: center;">
                    <div style="width: 50px; height: 50px; border-radius: 50%; background: #ddd; margin-right: 15px; overflow: hidden;">
                        <img src="../static/images/testimonials/user2.jpg" alt="User" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div>
                        <h4 style="margin: 0; font-size: 1.1rem;">Sarah Rodriguez</h4>
                        <p style="margin: 0; font-size: 0.9rem; color: #666;">Family Traveler</p>
                    </div>
                </div>
            </div>
            
            <div class="testimonial" style="background: white; padding: 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); position: relative;">
                <div style="position: absolute; top: -15px; left: 30px; font-size: 2rem; color: var(--primary-color);">
                    <i class="fas fa-quote-left"></i>
                </div>
                <p style="margin-top: 20px;">I was impressed when the AI recommended a luxury sedan at an affordable price for my anniversary weekend - it made our special occasion perfect!</p>
                <div style="margin-top: 20px; display: flex; align-items: center;">
                    <div style="width: 50px; height: 50px; border-radius: 50%; background: #ddd; margin-right: 15px; overflow: hidden;">
                        <img src="../static/images/testimonials/user3.jpg" alt="User" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div>
                        <h4 style="margin: 0; font-size: 1.1rem;">David Chen</h4>
                        <p style="margin: 0; font-size: 0.9rem; color: #666;">Weekend Getaway</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Price range display update
        const priceRange = document.getElementById('max-price');
        const priceDisplay = document.getElementById('price-display');
        
        priceRange.addEventListener('input', function() {
            priceDisplay.textContent = '$' + this.value;
        });
        
        // Form submission and AI recommendation display
        const recommendationForm = document.getElementById('recommendation-form');
        const resultsContainer = document.getElementById('recommendation-results');
        
        recommendationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading state
            resultsContainer.innerHTML = `
                <div style="text-align: center; padding: 50px 0;">
                    <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 20px;">
                        <i class="fas fa-cog fa-spin"></i>
                    </div>
                    <h3>Our AI is analyzing your preferences...</h3>
                    <p>This typically takes a few seconds.</p>
                </div>
            `;
            
            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
            
            // Simulate AI processing
            setTimeout(function() {
                // Generate form data for submission
                const formData = new FormData(recommendationForm);
                
                // Send to backend
                fetch('/get_recommendation', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Process and display recommendations
                    displayRecommendations(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    resultsContainer.innerHTML = `
                        <div style="text-align: center; padding: 30px; background: #fff0f0; border-radius: var(--border-radius);">
                            <div style="font-size: 3rem; color: #ff6b6b; margin-bottom: 20px;">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <h3>Something went wrong</h3>
                            <p>We couldn't process your request. Please try again later.</p>
                        </div>
                    `;
                });
            }, 2000);
        });
        
        function displayRecommendations(data) {
            // Create AI explanation section
            let resultsHTML = `
                <div class="ai-explanation">
                    <h3><i class="fas fa-robot"></i> AI Recommendation Analysis</h3>
                    <p>${data.explanation}</p>
                </div>
            `;
            
            // Add recommendations
            resultsHTML += `<h3 style="margin-bottom: 20px;">Your Personalized Vehicle Matches</h3>`;
            
            resultsHTML += `<div class="car-grid">`;
            
            // Add each car recommendation
            data.recommendations.forEach(recommendation => {
                const car = recommendation.car;
                const matchScore = recommendation.match_score;
                
                resultsHTML += `
                    <div class="car-card">
                        <img src="${car.image}" alt="${car.name}" class="car-image">
                        <div class="car-content">
                            <div class="car-title">
                                <h3>${car.name}</h3>
                                <div class="car-price">$${car.price_per_day}/day</div>
                            </div>
                            <span class="car-category">${car.category}</span>
                            <div class="car-features">
                                <span><i class="fas fa-user"></i> ${car.seats} seats</span>
                                <span><i class="fas fa-cog"></i> ${car.transmission}</span>
                            </div>
                            <div style="margin-top: 15px;">
                                <h4 style="margin-bottom: 5px; font-size: 0.9rem;">Key Features:</h4>
                                <ul style="font-size: 0.9rem; padding-left: 20px;">
                                    ${car.features.map(feature => `<li>${feature}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="car-rating" style="margin-top: 15px;">
                                <i class="fas fa-star"></i>
                                <span>${car.rating}/5</span>
                            </div>
                            <span class="match-score">${matchScore}% match</span>
                            <div style="margin-top: 15px;">
                                <button class="btn">Book This Car</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resultsHTML += `</div>`;
            
            // Add try again button
            resultsHTML += `
                <div style="text-align: center; margin-top: 40px;">
                    <button id="refine-search" class="btn btn-secondary">Refine Your Search</button>
                </div>
            `;
            
            // Update the results container
            resultsContainer.innerHTML = resultsHTML;
            
            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
            
            // Add event listener to the refine search button
            document.getElementById('refine-search').addEventListener('click', function() {
                recommendationForm.scrollIntoView({ behavior: 'smooth' });
            });
        }
    });
</script>
{% endblock %}